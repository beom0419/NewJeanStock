# 8/26 (월)

주말에 잡았던 문제([BOJ 24546 놀이기구에 진심인 편](https://www.acmicpc.net/problem/24546))가 방법은 맞는거 같은데 OOB가 나서 해결해보려고 했으나 결국 못풀었습니다.

[source code](http://boj.kr/c53bad2937d84bf8b4e1877bab72ac5a)

---

# 8/27 (화)

지난 공통 프로젝트 때 Spring Data JPA를 이용해 BE를 개발했었습니다. 대충 어떤 방식으로 동작하는지 흐름 정도와 크게 주의해야 할 상황들(1 + N 문제, enum type을 db에 mapping시 string으로 할 것, 등등) 정도만 알고 있는 상태로 개발을 시작했었습니다. 실제 동작 과정들은 잘 몰랐기에 공통 프로젝트가 끝난 이후부터 JAVA ORM 표준 JPA 강의를 듣고 있었고, 화/수에 걸쳐서 완강 했습니다.

오전: 

**프록시**

**즉시/지연 로딩**

오후: 팀 빌딩

---

# 8/28 (수)

**기본 쿼리 API**

**SELECT 프로젝션**

**페이징, 조인, 서브쿼리**

**JOIN FETCH(pros vs cons)**

---

# 8/29 (목)

모의 주식 투자 기반으로 특화 프로젝트를 할 계획이라 주식 관련 도메인 공부를 했습니다.

## 용어 정리

### 구조

- 위탁자(주식 매매거래를 위탁하는 투자자)

|    |    |
|:---:|:---:|
|  \|  |  ^   |
|매매거래 의사표시(주문)|  \|  |
|  \|  |매매거래내용 통지(체결 관련 정보)|
|  v   |  \|  |
| | |

- 회원(금융투자업의 인가를 받은 자, 한국거래소에 회원으로 등록되어 있음. 일반적으로 증권회사)

|   |    |
|:---:|:---:|
|  \|  |  ^   |
|매매거래 의사표시(호가 입력)|  \|  |
|  \|  | ??(알려진게 없.좌) |
|  v   |  \|  |
| | |

- 거래소시스템

### 위탁증거금/위탁증거금률

- 위탁 증거금: 회원(증권회사)이 투자자(위탁자)로부터 증권의 매매거래를 위탁받은 경우 위탁자의 결제이행을 확보하기 위해 징수하는 현금 또는 증권
- 약정 대금 중 미리 예탁해야 하는 보증금

- 증권회사가 투자자에게 매매거래 위탁을 받을 때 위탁증거금을 징수할 수 있음.

- 이 예탁해야하는 보증금의 비율이 위탁증거금률
    - 예를 들어, 내 주식 계좌에 100만원이 있고 내가 사려는 주식이 40% 위탁증거금률이라면 250만원까지 구매할 수 있다.

- 현재 대부분의 증권회사는 40%라고 함

### 위탁수수료

- 증권회사는 투자자로부터 매도/매수 위탁을 받아 매매가 성립되었으면 증권회사가 정한 바에 따라 위탁수수료를 징수할 수 있음.

- 24년기준 증권사별 국내주식 위탁수수료
    - KB증권
        - 0.0044792%
    - 미래에셋/삼성증권/한국투자증권/신한금융투자/키움증권/윾안타증권/머신증권
        - 0.0036396%
    - 하나증권
        - 0.0141639%
    - 토스증권/카카오페이증권
        - 0.015%


### 미수금

- 미수금: (증권)고객이 증권회사에 납부해야 할 현금 또는 유가증권의 부족액 

- 주식을 살 때 매수대금의 일부만 현금으로 내면 되고, 그 비율이 위탁증거금률이다. 주식거래 대금은 매매가 이루어진 날로부터 3일째 되는 날 결제되고(이를 "보통거래"라고 함) 3일 동안 외상거래가 가능하다. 주식을 사겠다고 주문을 낸 투자자가 3일 째 되는 날 대금을 내지 않으면 미수금으로 처리된다.

- 증권회사는 미수금이 생기면 바로 해당 주식을 정리하도록 되어있다.
    - 해당 고객이 산 주식을 결제일 다음날(매수일로부터 4일째 되는 날) 오전 동시호가 때 하한가에 ‘팔자’ 주문을 내야 한다. 이것을 반대매매라 부르며 반대매매를 통해 팔린 주식대금은 반대매매일로부터 3일째 되는 날 결제되므로 추가로 이틀 동안은 미수금으로 잡힌다.

### 주문 종류

| 주문 종류 | 설띵 |
| :---: | --- |
| 지정가주문 | 종목, 수량, 가격을 지정 |
| 시장가주문 | 종목, 수량은 지정. 가격은 지정 x |
| 조건부지정가주문 |  |
| 최유리지정가주문 |  |
| 최우선지정가주문 | |
| 목표가주문 | |
| 경쟁대략매매주문 | |

### 매매거래일

- 증권 시장은 공휴일, 근로자의 날, 토요일, 12월 31일(공휴일, 토요일이면 그 직전 매매거래일), 경제사정의 급변 혹은 급변의 예상되거나 한국거래소가 시장관리상 필요하다고 인정하는날을 제외한 월요일부터 금요일까지 열린다.

### 매매거래시간

- 정규시장/시간외시장으로 나뉨

- 정규시장
    - 정규시장: 09시 ~ 15시 30분
        - 장중경쟁대량매매: 09시 ~ 15시

- 시간외시장
    - 장 개시전 시간외시장: 08시 ~ 09시
        - 시간외종가매매: 08시 30분 ~ 08시 40분
    - 장종료후 시간외시장: 15시 40분 ~ 18시
        - 시간외종가매매: 15시 40분 ~ 16시
        - 시간외단일가매매: 16시 ~ 18시


### 단위/제한

- 호가수량단위는 1주. 마찬가지로 매매수량단위도 1주.

- 호가가격단위는 1주의 가격에따라 달라집니다.
    - 삼성전자 주가는 100원씩 변동하지만 더테크놀로지(뭔지도 모르는 주식)은 1원단위로 바뀌는걸 알 수 있음

|1주 가격(원)|호가 단위(원)|
|---:|---:|
| [      0,   2_000) |     1 |
| [  2_000,   5_000) |     5 |
| [  5_000,  20_000) |    10 |
| [ 20_000,  50_000) |    50 |
| [ 50_000, 200_000) |   100 |
| [200_000, 500_000) |   500 |
| [500_000,     INF) | 1_000 |

- 하루 동안 주가가 변동할 수 있는 폭은 기준가격 대비 상하 30%로 제한하고 있음.
    - 따라서 주식의 호가 가격은 기준가격(일반적으로 직전 매매거래일의 종가) 대비 30% 더한 가격(상한가)보다 높거나 30%를 뺀 가격(하한가)보다 낮으면 안됨.

### 경쟁매매의 원칙

| 구분 | 내용 |
|---|---|
|가격우선의 원칙|낮은 가격의 매도호가는 높은 가격의 매도호가에 우선함. 높은 가격의 매수호가는 낮은 가격의 매수호가에 우선함.[1] |
|시간우선의 원칙| 동일한 가격호가간의 우선순위와 시장가호가간의 우선순위는 호가|
|수량우선배분의 원칙|수량이 많은 호가가 수량이 적은 호가보다 우선함|
|위탁자우선의 원칙|상장지수집합투자기기구 집합투자증권, 상장지수증권 및 주식워런트증권은 위탁매매의 호가가 자기매매의 호가에 우선함.[2] |

- [1] 다만, 시장가호가는 지정가호가에 가격적으로 우선하되, 매도시장가호가와 하한가의 매도지정가호가, 매수시장가호가와 상한가의 매수지정가호가는 각각 동일한 가격의 호가로 봄

- [2] 이 경우 위탁매매의 호가간, 자기매매의 호가간에는 수량이 많은 호가가 수량이 적은 호가보다 우선함

- 시간우선의 원칙에서 대한민국 주식시장에서는 1/1000초 단위로 거래가 접수되어서 대부분 가격, 시간선에서 거래가 끝난다고 함.

- 위탁자우선의 원칙은 대충 개인투자자 주문을 기관투자자 주문보다 우선해서 체결한다는 원칙인데 사실상 수량에서 무조건 밀리기때문에 있으나마나한 원칙이라고 알고있음다...

### 구현시 고민해볼 점

- 거래소 자체를 구현하는게 아니라 체결 내역을 받아오고 우리가 주문은 쌓아놓고 실시간 체결 내역을 받아와서 이걸 개인의 주문내역에서 체결시키는 로직으로 구현할 것 같은데, (종목, 수량, 서버 기준으로 시각이 동일한) 시장가, 지정가 주문이 있으면 어떤 것을 먼저 처리할 것인가정도 고민해보면 될듯?

---

## Reference

- [찾기 쉬운 생활 법령 정보 - 주식투자자](https://www.easylaw.go.kr/CSP/CnpClsMain.laf?csmSeq=1701&ccfNo=2&cciNo=1&cnpClsNo=1)
- [한경 - 경제용어사전](https://dic.hankyung.com/)
- [꺼무위키 - 증거금](https://namu.wiki/w/%EC%A6%9D%EA%B1%B0%EA%B8%88)
- [24년 2월 기준 증권사별 국내 주식 수수료](https://simpleinvest.co.kr/%EA%B5%AD%EB%82%B4-%EC%A3%BC%EC%8B%9D-%EC%88%98%EC%88%98%EB%A3%8C-%EB%B9%84%EA%B5%90/)
